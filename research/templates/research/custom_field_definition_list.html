{% extends "layout/base.html" %}
{% block title %}Advanced Schema Builder | HelixMapr{% endblock %}
{% block header_title %}Advanced Dynamic Schema Builder{% endblock %}
{% block content %}
<div class="space-y-4">
  <div class="flex items-center justify-between">
    <h2 class="text-2xl font-bold">Dynamic Fields</h2>
    {% if can_edit_schema %}
    <div class="flex gap-2">
      <a href="{% url 'custom-field-group-create' %}" class="rounded-md border border-slate-600 px-4 py-2 text-sm">Add Section</a>
      <a href="{% url 'custom-field-definition-create' %}" class="rounded-md bg-primary px-4 py-2 text-sm font-semibold text-black">Add Field</a>
    </div>
    {% endif %}
  </div>
  {% for group in field_groups %}
    <div class="rounded-lg border border-slate-700 bg-slate-800 p-4" data-group-id="{{ group.id }}">
      <h3 class="mb-3 text-lg font-semibold">{{ group.name }}</h3>
      <ul class="space-y-2">
        {% for definition in custom_field_definitions %}
          {% if definition.group_id == group.id %}
          <li class="schema-field-item flex items-center justify-between rounded border border-slate-700 p-3" draggable="true" data-field-id="{{ definition.id }}">
            <span>{{ definition.label }} <span class="text-xs text-slate-400">({{ definition.key }} / {{ definition.get_field_type_display }})</span></span>
            {% if can_edit_schema %}
            <span class="flex gap-2">
              <a href="{% url 'custom-field-definition-update' definition.pk %}" class="text-primary hover:underline">Edit</a>
              <a href="{% url 'custom-field-definition-delete' definition.pk %}" class="text-red-400 hover:underline">Delete</a>
            </span>
            {% endif %}
          </li>
          {% endif %}
        {% endfor %}
      </ul>
    </div>
  {% endfor %}
</div>
<script src="/static/js/schema_builder.js"></script>
{% endblock %}
